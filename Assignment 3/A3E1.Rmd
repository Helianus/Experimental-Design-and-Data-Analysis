---
title: "A3E1"
author: "Xinyu Hu"
date: "2021/3/16"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
library(knitr)
```

# Exercise 1.
## a)
```{r,echo=FALSE}
ffdata = read.table('fruitflies.txt', header=T)
ffdata$loglongevity = log(ffdata$longevity)
par(mfrow=c(1,3))
plot(loglongevity~thorax, pch=c(22, 23, 24), data=ffdata)
abline(lm(loglongevity~thorax,data=ffdata[ffdata$activity=="high",]),col="red")
abline(lm(loglongevity~thorax,data=ffdata[ffdata$activity=="low",]),col="blue")
abline(lm(loglongevity~thorax,data=ffdata[ffdata$activity=="isolated",]),col="green")
boxplot(loglongevity~thorax,data=ffdata)
boxplot(loglongevity~activity, data=ffdata)
```
It is quite clear there exists a positive linear relationship between loglongevity and thorax. And the boxplots shows that loglongevity has influenced by thorax and activity. 
```{r}
ffaov = lm(loglongevity~activity, data=ffdata);anova(ffaov)
```
The anova test for testing $H_0$ shows the $p$-value = 1.798e-07 < 0.05, which concludes longevity is effected by activity.
```{r}
summary(ffaov)
```
From above summary, $\hat\mu$ = 3.60212, $\hat\alpha_{isolated}$=0.51722 and $\hat\alpha_{low}$=0.39771. Thus, estimated longevity of high $e^{3.60212}$=36.67, of isolated $e^{3.60212+0.51722}$=61.51 and of low $e^{3.60212+0.39771}$=54.58.

## b)
```{r}
fflm = lm(loglongevity~thorax+activity,data=ffdata);drop1(fflm,test="F")
```
With Single term deletions, $H_0$ is rejected because of $p$-value=4.000e-09 < 0.05. It shows that activity still influences longevity. 
```{r}
summary(fflm)
```
The summary shows the $\hat\mu$=1.21893, $\hat\alpha_{isolated}$=0.40998 and $\hat\alpha_{low}$=0.28570. In this case, activity decreases longevity.
```{r}
mean(ffdata$thorax)
```
The average thorax length = 0.8245333. Since the model is $\hat{Y}_i = \hat\mu+\hat\alpha_i+\hat\beta X_i$, $\hat{Y}_{isolated} = 1.21893 + 0.40998+2.97899*0.8245333=4.085186455367$, $\hat{Y}_{low} = 1.21893 + 0.28570+2.97899*0.8245333=3.960906455367$ and $\hat{Y}_{high} = 1.21893 + 0+2.97899*0.8245333=3.675206455367$. Additionally, the longevity of isolated $e^{Y_{isolated}}=e^{4.085186455367}$=59.45, of low $e^{Y_{low}}=e^{3.960906455367}$=52.50 and of high $e^{Y_{high}}=e^{3.675206455367}$=39.45.

## c)
```{r,echo=FALSE}
plot(loglongevity~thorax, pch=c(22, 23, 24), data=ffdata,main="sexual activity and thorax length")
abline(lm(loglongevity~thorax,data=ffdata[ffdata$activity=="high",]),col="red")
abline(lm(loglongevity~thorax,data=ffdata[ffdata$activity=="low",]),col="blue")
abline(lm(loglongevity~thorax,data=ffdata[ffdata$activity=="isolated",]),col="green")
```
```{r}
fflmm=lm(loglongevity~activity*thorax,data=ffdata);summary(fflmm)
```
The graph shows that each estimate for each group depending on the thorax length, and three lines are parallel. Additionally, from the summary, it shows that $p$-value for $H_0: \mu_{low}=\mu_{high}$ is 0.2771 > 0.05 and $p$-value for $H_0: \mu_{isolated}=\mu_{high}$ is 0.0545 > 0.05. Therefore, we reject both of them, and this dependence is similar under all three conditions of sexual activity.

## d)
```{r}
summary(ffaov)$r.squared
summary(fflm)$r.squared
```
The analyses with thorax length is preferred, because the one with thorax length has a explained variance of 70.9%, but the one without thorax length has only 35%. None of them is wrong. 

## e)
```{r,echo=FALSE}
par(mfrow=c(1,2))
plot(fflm,2);plot(fflm,1)
```
```{r}
mean(ffdata$thorax)
```
```{r}
shapiro.test(residuals(fflm))
```
By checking QQ-plot and residuals vs. fitted plot, ANCOVA with thorax length and activity are independent to each other. In addition, we did not find certain patterns exist in the graph, even though they look normally distributed which is also checked by Shapiro-Wilk normality test.

## f)
```{r}
fflaov=lm(longevity~thorax+activity, data=ffdata)
anova(fflaov)
```
Even without the logarithm, the ANCOVA shows very similar with the one with logarithm.
```{r}
par(mfrow=c(1,2))
plot(fflaov,2);plot(fflaov,1)
```
The graphs show that the residuals are normally distributed. And we can see a certain pattern existing in residuals fitted plot. This is also supported by Shapiro-Wilk normality test below.
```{r}
shapiro.test(residuals(fflaov))
```
However, the variance of residuals is getting larger as the the estimates gets larger. It does not reliable. Moreover, it is wise to use the model with logarithm.